## 		内部网关协议RIP

> ### 工作原理 
> ​		RIP是内部网关协议最先得到广泛应用的协议，是一种分布式的基于距离向量的路由选择协议，它最大的特点就是简单。RIP协议要求网络中的每一个路由器都要维护从它自己到其他每一个目的网络的距离记录。
>
> ​		什么是**距离**？从一路由器到直接连接的网络的距离定义为1*（或者等于0，此处了解即可）*，从一路由器到非直接连接的网络的距离为所经过的路由器数量加1。距离也称为**跳数**，每次经过一个路由器，跳数就加1。RIP语序一条链路上最多只有15个路由器，距离等于16时相当于不可达，由此可见，RIP只适合小型互联网。
>
> ​		RIP不能在两个网络中同时使用多个条路由，它只会选择距离最短的那一条，如果有另一条时延更低，质量更好的路由，但是距离却比较长的，RIP不会选择它。可以看出，RIP的确简单，但是它自身的局限性也比较大。
>
> ###  RIP协议的特点
>
> * 仅和相邻的路由器交换信息
>
> * 路由器交换的信息为当前本路由器所知道的所有信息，也就是现在自己的路由表
>
> * 按照固定的时间间隔交换路由信息，当网络拓扑发生变化时，也及时更新信息  
>
>   ​		RIP协议刚开始工作时，所有路由器的路由表都是空的，每个路由首先得到直接相连的网络距离信息，然后再与它相邻的路由器交换信息，经过若干论交换信息后，所有路由的路由表都有了到任一网络的最短距离信息和下一跳路由器地址。就像一个班级每一个学生，都有一个自己的秘密， 然后告诉前后左右的四个人，下一轮，把自己所知道的全部秘密（包括别人的），又告诉周围的四个人。这样最终，每个人都能知道其他人的秘密。

> ### 距离向量算法
>
> 首先，当前路由表的组成如下，**<目的网络 N，跳数，下一跳地址> **
>
> 1. 从相邻的 X 路由器接收发送过来的 RIP（Routing Information Protocol） 报文
> 2. 将该 RIP 报文中的下一跳地址修改为 X，且跳数增加 1
> 3. 对每个项目执行如下步骤
> a.若原路由表没有 RIP 中的目的网络 N，直接添加到原路由表中
> b.若原路由表中有 RIP 中的目的网络 N，但下一跳地址不是 X ，选择跳数少的替换。如果两者跳数一样，则保留原路由表的项。
> c.若原路由表中有 RIP 中的目的网络 N，且下一跳地址是 X，使用收到的项替换
> 若超过 180s （RIP 默认 180s）还没有收到相邻路由器的更新路由表，则相邻路由器置为不可达，跳数为 16    
>
> 其实这个算法还是挺简单的，废话少说，上例子
>
> | 目的网络 | 距离 | 下一跳地址 |
> | :------: | :--: | :--------: |
> |   Net2   |  3   |     R4     |
> |   Net3   |  4   |     R5     |
> |  ......  |      |            |
>
> ​												                                R6的路由表
>
> 
>
> | 目的网络 | 距离 | 下一跳地址 |
> | :------: | :--: | :--------: |
> |   Net1   |  3   |     R1     |
> |   Net2   |  4   |     R2     |
> |   Net3   |  1   |  直接交付  |
>
> ​																		R4发来的路由信息
>
> 首先，按照第一步***将该 RIP 报文中的下一跳地址修改为 X，且跳数增加 1***
> 
> | 目的网络 | 距离 | 下一跳地址 |
> | :------: | :--: | :--------: |
> |   Net1   |  4   |     R4     |
> |   Net2   |  5   |     R4     |
> |   Net3   |  2   | R4 |
>
> 第二，将这个表和R6的表比较
>
> ​		第一行在R6路由表中没有，所以加入进去
>
> ​		第二行R6路由表中有，且下一跳也是R4，根据***若原路由表中有 RIP 中的目的网络 N，且下一跳地址是 X，使用收到的项替换***，进行替换。
>
> ​		第三行在R6表中也有，但是下一跳地址不一样，因此要比较距离，进行替换。***若原路由表中有 RIP 中的目的网络 N，但下一跳地址不是 X ，选择跳数少的替换。如果两者跳数一样，则保留原路由表的项。***
>
> | 目的网络 | 距离 | 下一跳地址 |
> | :------: | :--: | :--------: |
> |   Net1   |  4   |     R4     |
> |   Net2   |  5   |     R4     |
> |   Net3   |  2   | R4  |
>
> ​	RIP协议让一个自治系统的所有路由器定期与自己的相邻路由器交换路由信息，并不断更新其路由表，使得每一个路由器到目的网络的路由都是最短的。
>


> ### RIP报文协议格式
>
> <img src="https://github.com/guguchen/blog/blob/master/rip-format-rip2.png" alt="rip-format-rip2" style="zoom:150%;" />
>
> 
>
> |              字段名              | 长度  |                             含义                             |
> | :------------------------------: | :---: | :----------------------------------------------------------: |
> |             Command              | 8bit  | 标识报文的类型：<br/>     1：Request报文，向邻居请求全部或部分路由信息；<br/>     2：Reponse报文，发送自己全部或部分路由信息，一个Response报文中最多包含25个路由表项。 |
> |             Version              | 8bit  |           RIP的版本号：<br/>1：RIP-1<br/>2：RIP-2            |
> |           Must be zero           | 16bit |                         必须为零字段                         |
> | AFI（Address Family Identifier） | 16bit | 地址族标识，其值为2时表示IP协议。对于Request报文，此字段值为0。 |
> |            Route Tag             | 16bit |                        外部路由标记。                        |
> |            IP Address            | 32bit | 该路由的目的IP地址，可以是自然网段的地址，也可以是子网地址或主机地址。 |
> |           Subnet Mask            | 32bit |                       目的地址的掩码。                       |
> |             Next Hop             | 32bit | 提供一个更好的下一跳地址。如果为0.0.0.0，则表示发布此路由的路由器地址就是最优下一跳地址。 |
> |              Metric              | 32bit |         路由的开销值。对于Request报文，此字段为16。          |
>
> ​		RIP还存在一个较大的问题就是当网络出现故障时，要经过比较长的时间才能将此信息传送到所有的路由器。这一特点叫做**好消息传播地快，坏消息传播地慢**。



>	​		总之,RIP最大地优点就是实现简单,开销小.同时它也限制了网络的规模,当路由器较多时,路由消息传播慢,收敛时间过长.不过目前在规模小的网络中,RIP还是占据了大多数.









